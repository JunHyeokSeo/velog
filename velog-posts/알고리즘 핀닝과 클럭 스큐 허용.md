<h2 id="문제-정의-jwt-알고리즘-위조-및-서버-간-시계-불일치">문제 정의: JWT 알고리즘 위조 및 서버 간 시계 불일치</h2>
<p>JWT는 토큰 헤더에 서명 알고리즘(<code>alg</code>)을 명시하는데, 클라이언트가 이를
조작할 경우 서버가 검증을 잘못 처리할 위험이 있다. 대표적인 예시는
<code>alg=none</code> 취약점이다. 잘못된 서버 구현에서는 서명이 없는 토큰을
정상으로 인식할 수 있다.
또한 서버 인프라 환경에서는 노드별 시계가 완벽히 일치하지 않을 수 있다.
분산 시스템에서는 수 초 정도의 오차가 발생할 수 있고, 이로 인해 토큰이
실제로는 유효하지만 만료로 잘못 판정될 수 있다.</p>
<p>따라서 <strong>알고리즘 핀닝</strong>(서버에서 기대하는 알고리즘을 고정)과 <strong>클럭
스큐 허용</strong>(허용 오차 범위 설정)이 필요하다.</p>
<hr />
<h2 id="구현-전략-알고리즘-고정-검증">구현 전략: 알고리즘 고정 검증</h2>
<p>JwtValidator는 토큰 헤더의 <code>alg</code> 값을 직접 확인하고, 서버가 허용하는
알고리즘(HS256)과 일치하지 않으면 인증 실패로 처리한다.</p>
<pre><code class="language-java">JwsHeader&lt;?&gt; header = parsedToken.getHeader();
if (!SignatureAlgorithm.HS256.getValue().equals(header.getAlgorithm())) {
    log.warn("{}알고리즘 불일치 - provided={}, expected={}", 
              LogTag.SECURITY_JWT, header.getAlgorithm(), SignatureAlgorithm.HS256.getValue());
    throw new UnsupportedAlgorithmAuthenticationException(ErrorCode.UNSUPPORTED_ALGORITHM.getMessage());
}</code></pre>
<p>이 로직은 클라이언트가 토큰 헤더를 변조하더라도 서버가 명시적으로 차단할
수 있도록 한다. 즉, <strong>alg 파라미터를 신뢰하지 않고 서버에서 고정
검증</strong>하는 방식이다.</p>
<hr />
<h2 id="구현-전략-클럭-스큐-허용">구현 전략: 클럭 스큐 허용</h2>
<p>JwtValidator는 JJWT의 <code>setAllowedClockSkewSeconds</code> 옵션을 활용하여,
유효기간 검증 시 ±60초의 시계 차이를 허용한다.</p>
<pre><code class="language-java">Jws&lt;Claims&gt; parsedToken = Jwts.parserBuilder()
        .setSigningKey(jwtTokenProvider.getSecretKey())
        .setAllowedClockSkewSeconds(60)
        .build()
        .parseClaimsJws(token);</code></pre>
<p>이 설정으로 인해 다음과 같은 상황을 방지할 수 있다. - 서버 노드 간 시계
오차로 인한 불필요한 인증 실패\</p>
<ul>
<li>클라이언트-서버 간 네트워크 지연으로 발생하는 토큰 검증 오류</li>
</ul>
<hr />
<h2 id="근거">근거</h2>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7518">RFC 7518 (JSON Web Algorithms)</a>에서는 서버가 허용할 알고리즘을 명확히 지정해야 함을 권장한다.</li>
<li><a href="https://java.libhunt.com/jjwt-changelog/0.7.0?utm_source=chatgpt.com">JJWT 공식 문서</a>에서도 <code>setAllowedClockSkewSeconds</code> 옵션을 통해 분산 환경에서의 안정성을 확보할 수 있음을 설명한다.</li>
</ul>