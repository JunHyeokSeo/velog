<h2 id="61-다대일">6.1 다대일</h2>
<p>데이터베이스 테이블의 일(1), 다(N) 관계에서 외래 키는 항상 다쪽에 있다.
따라서 객체 양방향 관계에서 연관관계의 주인은 항상 다쪽이다.</p>
<h3 id="다대일-양방향">다대일 양방향</h3>
<blockquote>
<p><code>양방향 연관관계는 항상 서로를 참조해야 한다.</code>
어느 한 쪽만 참조하면 양방향 연관관계가 성립하지 않는다. 
항상 서로 참조하게 하려면 연관관계 편의 메소드를 작성하는 것이 좋다.
편의 메소드는 한 곳에만 작성하거나 양쪽 다 작성할 수 있는데, 양쪽에 다 작성하면 무한루프에 빠지는 경우도 있으므로 주의해야 한다.
무한루프에 빠지지 않도록 로직을 추가할 수도 있지만,  <code>한쪽에 작성하는 것을 추천</code>한다.
편의 메소드는 <code>연관관계의 주인쪽에서만 제공</code>하도록 하는 것이 바람직하다.</p>
</blockquote>
<h2 id="62-일대다">6.2 일대다</h2>
<p>일대다 관계는 다대일 관계의 반대 방향이다.
일대대 관계는 엔티티를 하나 이상 참조할 수 있으므로 자바 컬렉션 중에 하나를 사용해야 한다.</p>
<h3 id="일대다-단방향">일대다 단방향</h3>
<blockquote>
<p><code>일대다 단방향만 존재</code>할 때, 상대 테이블의 외래 키를 직접 조작하려 함
하지만 외래 키는 <strong>다른 테이블(Member 등)</strong>에 있으므로, <strong>해당 테이블을 수정(</strong>UPDATE<strong>)해야 연관관계가 성립</strong> 
따라서 INSERT → UPDATE <strong>두 번의 SQL</strong>이 실행되는 비효율 발생
일대다 단방향 관계를 매핑할 때는 <code>@JoinColumn</code>을 명시해야 한다. 그렇지 않으면 JPA는 연결 테이블을 중간에 두고 연관관계를 관리하는 조인 테이블 전략을 기본으로 사용해서 매핑한다.
<code>일대다 단방향 매핑의 단점</code>은 매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다는 점이다. 본인 테이블에 외래 키가 있으면 엔티티의 저장과 연관관계 처리를 <code>INSERT SQL</code> 한 번으로 끝낼 수 있지만 다른 테이블에 외래 키가 있으면 연관관계 처리르 위한 <code>UPDATE SQL</code>을 추가로 실행해야 한다.</p>
</blockquote>
<pre><code># Member &lt;-(단방향)- Team 일 때,

Member persist -&gt; Team persist -&gt; Member.team Update</code></pre><h2 id="63-일대일">6.3 일대일</h2>
<p>양쪽이 서로 하나의 관계만을 가진다.
주 테이블이나 대상 테이블 중 어느 곳이나 외래 키를 가질 수 있다.
<code>JPA 개발에서는 주 테이블에 외래 키를 두는 것을 선호한다.</code></p>
<blockquote>
<p>프록시를 사용할 때 외래 키를 직접 관리하지 않는 일대일 관계는 지연 로딩으로 설정해도 즉시 로딩 된다.
주 객체에서 대상 객체를 사용할 때는 지연 로딩 되지만, 반대는 불가능하다.</p>
</blockquote>
<h2 id="64-다대다">6.4 다대다</h2>
<p>관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다. 그래서 보통 다대다 관계를 일대다, 다대일 관계로 풀어내는 연결 테이블을 사용한다.
객체는 테이블과 다르게 객체 2개로 다대다 관계를 만들 수 있다. 예를들어 회원 객체는 컬렉션을 사용해서 상품들을 참조하면 되고 반대로 상품들도 컬렉션을 사용해서 회원들을 참조하면 된다.</p>
<h3 id="다대다-매핑의-한계와-극복-연결-엔티티-사용">다대다: 매핑의 한계와 극복, 연결 엔티티 사용</h3>
<p><code>@ManyToMany</code>를 사용하면 연결 테이블을 자동으로 처리해주므로 도메인 모델이 단순해지고 여러가지로 편리하지만 추가 정보를 담을 수 없어 실무에서 사용하기에는 한계가 있다.
결국 연결 테이블을 매핑하는 연결 엔티티를 만들고 이곳에 추가한 컬럼들을 매핑해야 한다. 엔티티 간의 관계도 다대다에서 일대다, 다대일 관계로 풀어야 한다.</p>
<h3 id="다대다-연관관계-정리">다대다 연관관계 정리</h3>
<blockquote>
<p>객체 입장에서 보면 비식별 관계를 사용하는 것이 식별자 클래스를 만들지 않아도 되므로 단순하고 편리하다. 
이러한 이유로 식별 관계보다는 <code>비식별 관계를 추천</code>한다.</p>
</blockquote>
<p>다대다 관계를 일대다 다대일 관계로 풀어내기 위해 연결 테이블을 만들 때 식별자를 어떻게 구성할지 선택해야 한다.</p>
<ul>
<li>식별 관계 : 받아온 식별자를 기본 키 + 외래 키로 사용<ul>
<li>복합키 사용</li>
<li>JPA에서 복합키를 사용하려면 별도의 식별자 클래스를 만들어야 한다.</li>
<li>엔티티에 <code>@IdClass</code>를 사용해서 식별자 클래스를 지정하면 된다.</li>
</ul>
</li>
<li>비식별 관계 : 받아온 식별자는 외래 키로만 사용하고 새로운 식별자를 추가<ul>
<li>추천하는 기본 키 생성 전략은 데이터베이스에서 자동으로 생성해주는 대리 키를 Long 값으로 사용하는 것</li>
<li>ORM 매핑 시에 복합 키를 만들지 않아도 되므로 간단히 매핑을 완성할 수 있다.</li>
</ul>
</li>
</ul>